<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>RACE</title>

        <link href="../race-html.css" rel="stylesheet"/>
    </head>

    <body>
        <div class="navbar">
            <div class=""banner>
                <a href="../index.html" ><img class="logo" src="../images/race128.png"></a>
                <p class="doctitle">RACE Manual</p>
            </div>
            <br/>
            <div class="toc">
                <p class="title">Project Links</p>
                <ul>
                    <li><span class="toc level2"><a href="https://github.com/NASARace/race.git">Repository</a></span></li>
                    <li><span class="toc level2"><a href="http://nasarace.github.io/race">Website</a></span></li>
                </ul>
            </div>
            <div class="toc pagetoc">
                <p class="title">Page</p>
                <ul class="nav-list">
                  <li class="level1 active"><a href="#">Using Encrypted Configurations</a></li>
                  <li class="level2"><a href="#_1-create-plain-text-config-file-with-sensitive-data">(1) create plain text config file with sensitive data</a></li>
                  <li class="level2"><a href="#_2-encrypt-file">(2) encrypt file</a></li>
                  <li class="level2"><a href="#_3-use-encryption-keys-in-universe-satellite-config-values">(3) use encryption keys in universe/satellite config values</a></li>
                  <li class="level2"><a href="#_4-run-race">(4) run RACE</a></li>
                  <li class="level2"><a href="#using-keystores">using keystores</a></li>
                  <li class="level2"><a href="#typical-example">typical example</a></li>
                </ul>
            </div>
            <div class="toc globaltoc">
                <p class="title">Site</p>
                <ul class="nav-list">
                  <li class="level1 nav-header">RACE Manual</li>
                  <li class="level2"><a href="../index.html">About RACE</a></li>
                  <li class="level2 nav-header">Installing RACE</li>
                  <li class="level3"><a href="../installation/prerequisites.html">Prerequisites</a></li>
                  <li class="level3"><a href="../installation/download.html">Downloading RACE</a></li>
                  <li class="level3"><a href="../installation/build.html">Building RACE</a></li>
                  <li class="level3"><a href="../installation/pitfalls.html">Installation Pitfalls</a></li>
                  <li class="level3"><a href="../installation/osx.html">OS X Specifics</a></li>
                  <li class="level2 nav-header">Using RACE</li>
                  <li class="level3"><a href="running.html">How to Run RACE</a></li>
                  <li class="level3"><a href="configuration.html">RACE Configuration</a></li>
                  <li class="level3 active"><a href="#">Using Encrypted Configurations</a></li>
                  <li class="level2 nav-header">RACE Design</li>
                  <li class="level3"><a href="../design/overview.html">Design Overview</a></li>
                  <li class="level3"><a href="../design/actors.html">Actors</a></li>
                  <li class="level3"><a href="../design/configuration.html">Runtime Configuration</a></li>
                  <li class="level3"><a href="../design/raceactors.html">RaceActors</a></li>
                  <li class="level3"><a href="../design/channeltopics.html">ChannelTopics</a></li>
                  <li class="level3"><a href="../design/embedded-objects.html">Embedded Objects</a></li>
                  <li class="level3"><a href="../design/connectivity.html">Connecting External Systems</a></li>
                  <li class="level3"><a href="../design/remoting.html">Remote RaceActors and Distributed RACE Applications</a></li>
                  <li class="level3"><a href="../design/remotelauncher.html">RemoteLauncher</a></li>
                  <li class="level3"><a href="../design/hc.html">Heterogeneous Computing in RACE</a></li>
                  <li class="level3"><a href="../design/parsing.html">RACE Parsers</a></li>
                  <li class="level3"><a href="../design/archive-replay.html">Archive and Replay</a></li>
                  <li class="level3"><a href="../design/timeseries.html">Time Series Analysis</a></li>
                  <li class="level3"><a href="../design/trajectory.html">Trajectory Infrastructure</a></li>
                  <li class="level3"><a href="../design/rgis.html">RACE GIS Support</a></li>
                  <li class="level3"><a href="../design/worldwind.html">WorldWind Viewer</a></li>
                  <li class="level3"><a href="../design/http-server.html">HttpServer</a></li>
                  <li class="level3"><a href="../design/http-client.html">HttpImportActor</a></li>
                  <li class="level3"><a href="../design/share.html">SHARE - System for Hierarchical Ad hoc Reporting</a></li>
                  <li class="level3"><a href="../design/layers-and-modules.html">Layers and Modules</a></li>
                  <li class="level3"><a href="../design/directory-structure.html">Directory Structure</a></li>
                  <li class="level3"><a href="../design/repository.html">Repository Structure</a></li>
                  <li class="level3"><a href="../design/local-build.html">Local Build Configuration</a></li>
                  <li class="level3"><a href="../design/dds.html">RACE and DDS</a></li>
                  <li class="level3"><a href="../design/extproject.html">Using RACE from External Projects</a></li>
                  <li class="level3"><a href="../design/whyscala.html">Why Scala</a></li>
                  <li class="level2 nav-header">Documentation</li>
                  <li class="level3"><a href="../documentation/overview.html">RACE Documentation Overview</a></li>
                  <li class="level3"><a href="../documentation/presentations.html">Available Slide Presentations</a></li>
                  <li class="level2 nav-header">Annex</li>
                  <li class="level3"><a href="../annex/project-log.html">Project Log</a></li>
                  <li class="level3"><a href="../annex/examples.html">RACE Examples</a></li>
                  <li class="level3"><a href="../annex/known-problems.html">Known Problems</a></li>
                  <li class="level3"><a href="../annex/changes.html">Changes</a></li>
                  <li class="level3"><a href="../annex/todo.html">TODO List</a></li>
                  <li class="level3"><a href="../annex/learning.html">Learning Resources</a></li>
                  <li class="level3"><a href="../annex/glossary.html">Glossary</a></li>
                </ul>
            </div>
        </div>

        <div class="main">
            <h1 id="using-encrypted-configurations" class="title">Using Encrypted Configurations</h1>
            <p>RACE supports encrypted configuration values for sensitive information such as
            user credentials. To use encryption, follow these steps:</p>
            
            <h4 id="_1-create-plain-text-config-file-with-sensitive-data" class="section"><a class="anchor-link left" href="#_1-create-plain-text-config-file-with-sensitive-data"><i class="icofont-laika">&#xef71;</i></a>(1) create plain text config file with sensitive data</h4>
            <p>This is a normal configuration file. The toplevel node has to be &quot;secret {..}&quot;,
            but all other keys can be chosen freely, those will be later-on referenced as config
            values in the universe configs:</p>
            <pre><code>//------ crypt: encrypted configuration values
secret {
  swim.user = &quot;gonzo&quot;
  swim.pw = &quot;mysupersecretpassword&quot;
  ...
}</code></pre>
            <p>Store this file in the RACE root directory as <code>conf</code></p>
            
            <h4 id="_2-encrypt-file" class="section"><a class="anchor-link left" href="#_2-encrypt-file"><i class="icofont-laika">&#xef71;</i></a>(2) encrypt file</h4>
            <p>RACE comes with a <code>CryptConfig</code> application and a respective wrapper script,
            which is executed like this:</p>
            <pre><code>&gt; script/encryptconfig conf</code></pre>
            <p>When asked, enter a passphrase (and remember - it is not stored anywhere). This
            will create a encrypted file <code>conf.crypt</code> and delete the plain text <code>conf</code> file.</p>
            <p>The <code>encryptconfig</code> tool also supports a <code>--keep</code> command line option to keep the
            input file. If the option is <em>not</em> specified, the un-encrypted input file will be deleted.</p>
            <p>Values in the encrypted file will be double-encrypted and are never stored as
            plain text during RACE execution</p>
            
            <h4 id="_3-use-encryption-keys-in-universe-satellite-config-values" class="section"><a class="anchor-link left" href="#_3-use-encryption-keys-in-universe-satellite-config-values"><i class="icofont-laika">&#xef71;</i></a>(3) use encryption keys in universe/satellite config values</h4>
            <p>The keys from step (1) are used as <code>??</code> prefixed values in the respective
            config files, e.g.</p>
            <pre><code>//--- myuniverse.conf : sample universe config
  ...
  user = &quot;??swim.user&quot;
  pw = &quot;??swim.pw&quot;
  ...</code></pre>
            
            <h4 id="_4-run-race" class="section"><a class="anchor-link left" href="#_4-run-race"><i class="icofont-laika">&#xef71;</i></a>(4) run RACE</h4>
            <p>When executing RACE, use the <code>--vault &lt;path&gt;</code> option to specify which encrypted config file to use</p>
            <pre><code>&gt; ./race --vault conf.crypt config/myuniverse.conf</code></pre>
            <p>The system will prompt you for the same pass phrase that was entered in step (1). If the user enters 
            a wrong pass phrase, or takes too long to enter it, RACE will terminate immediately.</p>
            <p><strong>NOTE</strong> <code>*.crypt</code> files are not kept in the repository, they are filtered by <code>.gitignore</code></p>
            
            <h2 id="using-keystores" class="section"><a class="anchor-link left" href="#using-keystores"><i class="icofont-laika">&#xef71;</i></a>using keystores</h2>
            <p>Both <code>encryptconfig</code> and <code>race</code> also support the use of a keystore file for vault encryption/decryption,
            such as in</p>
            <pre><code>&gt; ./race --vault conf.crypt --keystore race.ks --alias mykeyname someconfig.conf
</code></pre>
            <p>KeyStores can be created with the <a href="http://docs.oracle.com/javase/8/docs/technotes/tools/windows/keytool.html">standard keytool</a> that is distributed with Java, and 
            should have a store type of &quot;JCEKS&quot;. Keys used for vault encryption have to be &quot;AES&quot; keys. A sample
            use would be</p>
            <pre><code>&gt; keytool -genseckey -alias mykeyname -keystore race-ks -storetype jceks -keyalg AES -keysize 256
</code></pre>
            <p>If a keystore is specified, RACE will ask for the keystore password instead of the vault password</p>
            
            <h2 id="typical-example" class="section"><a class="anchor-link left" href="#typical-example"><i class="icofont-laika">&#xef71;</i></a>typical example</h2>
            <p>Encrypted configuration is typically used by the <code>PortForwarder</code> and <code>JMSImportActor</code> actors in order
            to specify access to gateways and JMS servers. This generally works by first establishing a ssh
            session to a gateway through which respective ports for JMS servers are forwarded. Both URLs and
            credentials for the gateway and JMS server should be protected. As the highest value asset, the 
            <code>PortForwarder</code> interactively queries the password for the gateway which is never stored in 
            the configuration file:</p>
            <pre><code>...
{ name = &quot;portMapper&quot;
  class = &quot;.actor.PortForwarder&quot;
  user = &quot;??gw.user&quot;
  host = &quot;??gw.host&quot;
  forward = &quot;??gw.forward&quot;
}, ...
{ name = &quot;sfdps-jmsImporter&quot;
  class = &quot;.jms.JMSImportActor&quot;
  broker-uri = &quot;??swim.uri.sfdps&quot;
  user = &quot;??swim.user&quot;
  pw = &quot;??swim.pw&quot;
  write-to = &quot;/swim/sfdps&quot;
  jms-topic = &quot;&lt;jms-topic&gt;&quot;
},...</code></pre>
            <p>The respective vault file in clear text looks like this:</p>
            <pre><code>gw {
  forward=&quot;&lt;source-port&gt;:&lt;destination-host&gt;:&lt;destination-port&gt;,...&quot;
  host=&quot;&lt;gateway-hostname&gt;&quot;
  user=&quot;&lt;gateway-userid&gt;&quot;
}...
swim {
    pw=&quot;&lt;jms-password&gt;&quot;
    uri {
        sfdps=&quot;tcp://localhost:&lt;source-port&gt;&quot;  // via port forwarding from gateway
        ...
    }
    user=&quot;&lt;jms-userid&gt;&quot;
}...</code></pre>
        </div>

    </body>
</html>