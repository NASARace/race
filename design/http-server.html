<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>RACE</title>

        <link href="../race-html.css" rel="stylesheet"/>
    </head>

    <body>
        <div class="navbar">
            <div class=""banner>
                <a href="index.html" ><img class="logo" src="../images/race128.png"></a>
                <p class="doctitle">RACE Manual</p>
            </div>
            <br/>
            <div class="toc">
                <p class="title">Project Links</p>
                <ul>
                    <li><span class="toc level2"><a href="https://github.com/NASARace/race.git">Repository</a></span></li>
                    <li><span class="toc level2"><a href="http://nasarace.github.io/race">Website</a></span></li>
                </ul>
            </div>
            <div class="pagetoc">
                <div class="toc">
                  <p class="title">Page</p>
                </div>
            </div>
            <div class="globaltoc">
                <div class="toc">
                  <p class="title">Site</p>
                  <ul>
                    <li><span class="toc level1"><a href="../index.html">About RACE</a></span></li>
                    <li><span class="toc level1"><a href="../project-log.html">Project Log</a></span></li>
                    <li>
                      <p class="toc level1">Installing RACE</p>
                      <ul>
                        <li><span class="toc level2"><a href="../installation/prerequisites.html">Prerequisites</a></span></li>
                        <li><span class="toc level2"><a href="../installation/download.html">Downloading RACE</a></span></li>
                        <li><span class="toc level2"><a href="../installation/build.html">Building RACE</a></span></li>
                        <li><span class="toc level2"><a href="../installation/pitfalls.html">Installation Pitfalls</a></span></li>
                        <li><span class="toc level2"><a href="../installation/osx.html">OS X Specifics</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">Using RACE</p>
                      <ul>
                        <li><span class="toc level2"><a href="../usage/running.html">How to Run RACE</a></span></li>
                        <li><span class="toc level2"><a href="../usage/configuration.html">RACE Configuration</a></span></li>
                        <li><span class="toc level2"><a href="../usage/encryption.html">Using Encrypted Configurations</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1"><a href="../actors.html">Actors</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../actors.html#actor-components-and-properties">Actor Components and Properties</a></span></li>
                        <li><span class="toc level2"><a href="../actors.html#actor-communication">Actor Communication</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">RACE Design</p>
                      <ul>
                        <li><span class="toc level2"><a href="overview.html">Design Overview</a></span></li>
                        <li><span class="toc level2"><a href="configuration.html">Runtime Configuration</a></span></li>
                        <li><span class="toc level2"><a href="raceactors.html">RaceActors</a></span></li>
                        <li><span class="toc level2"><a href="channeltopics.html">ChannelTopics</a></span></li>
                        <li><span class="toc level2"><a href="embedded-objects.html">Embedded Objects</a></span></li>
                        <li><span class="toc level2"><a href="connectivity.html">Connecting External Systems</a></span></li>
                        <li><span class="toc level2"><a href="archive-replay.html">Archive and Replay</a></span></li>
                        <li><span class="toc level2"><a href="worldwind.html">WorldWind Viewer</a></span></li>
                        <li><span class="toc level2 active">HttpServer</span></li>
                        <li><span class="toc level2"><a href="timeseries.html">Time Series Analysis</a></span></li>
                        <li><span class="toc level2"><a href="remotelauncher.html">RemoteLauncher</a></span></li>
                        <li><span class="toc level2"><a href="layers-and-modules.html">Layers and Modules</a></span></li>
                        <li><span class="toc level2"><a href="directory-structure.html">Directory Structure</a></span></li>
                        <li><span class="toc level2"><a href="repository.html">Repository Structure</a></span></li>
                        <li><span class="toc level2"><a href="local-build.html">Local Build Configuration</a></span></li>
                        <li><span class="toc level2"><a href="dds.html">RACE and DDS</a></span></li>
                        <li><span class="toc level2"><a href="extproject.html">Using RACE from External Projects</a></span></li>
                        <li><span class="toc level2"><a href="whyscala.html">Why Scala</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1"><a href="../examples.html">RACE Examples</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../examples.html#basic-examples">Basic Examples</a></span></li>
                        <li><span class="toc level2"><a href="../examples.html#distributed-operation">Distributed Operation</a></span></li>
                        <li><span class="toc level2"><a href="../examples.html#live-data-import">Live Data Import</a></span></li>
                        <li><span class="toc level2"><a href="../examples.html#data-replay">Data Replay</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">Documentation</p>
                      <ul>
                        <li><span class="toc level2"><a href="../documentation/overview.html">RACE Documentation Overview</a></span></li>
                        <li><span class="toc level2"><a href="../documentation/presentations.html">Available Slide Presentations</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1"><a href="../known-problems.html">Known Problems</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../known-problems.html#build">Build</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#runtime">Runtime</a></span></li>
                      </ul>
                    </li>
                    <li><span class="toc level1"><a href="../changes.html">Changes</a></span></li>
                    <li><span class="toc level1"><a href="../todo.html">TODO List</a></span></li>
                    <li>
                      <p class="toc level1"><a href="../learning.html">Learning Resources</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../learning.html#scala">Scala</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#actors-and-akka">Actors and Akka</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#sbt">SBT</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#interactive-scala-akka-and-sbt-learning-environment-and-examples">Interactive Scala, Akka and SBT Learning Environment and Examples</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#git">Git</a></span></li>
                      </ul>
                    </li>
                    <li><span class="toc level1"><a href="../glossary.html">Glossary</a></span></li>
                  </ul>
                </div>
            </div>
        </div>

        <div class="main">
            <h1 id="httpserver" class="title">HttpServer</h1>
            <p>One of the use cases of RACE is to analyze large data streams and make results available online,
            i.e. outside of RACE. To support this RACE includes the <code>gov.nasa.race.http.HttpServer</code>, which
            is a low- to mid-level traffic web server that can be configured with <code>RaceRouteInfo</code> objects,
            to turn data received from RACE channels into dynamic HTML content and map it to URIs, supporting
            dynamic refresh, user authentication, logging and more.</p>
            <p>Like every web server, <code>HttpServer</code> has two major functions:</p>
            <ul>
              <li>routing - mapping trees of URIs to content and http methods)</li>
              <li>content management - creating and retrieving web content</li>
            </ul>
            <p>For routing <code>HttpServer</code> leans heavily on the <a href="https://doc.akka.io/docs/akka-http/current/scala/http/">AkkaHttp</a> library, which provides a full
            <a href="https://doc.akka.io/docs/akka-http/current/scala/http/routing-dsl/index.html">DSL</a> to hierarchically define URI systems with interspersed processing elements such as
            <a href="https://tools.ietf.org/html/rfc2616">HTTP</a> methods and path combinators. The DSL itself is beyond the scope of this document, here we
            just note that each configured <code>RaceRoutInfo</code> can provide its own <code>route()</code> method that
            returns a <code>akka.http.scaladsl.server.Route</code> object.</p>
            <p><img class="center scale90" src="../images/http-server.svg" alt="HttpServer"></p>
            <p><code>RaceRouteInfo</code> is the construct that ties data acquisition, content creation and content/route
            association together. Each <code>HttpServer</code> instance can be configured with any number of
            <code>RaceRouteInfo</code> objects, which in turn can have their own configuration parameters. The design is
            similar to <code>RaceViewerActor</code> and <code>RaceLayerInfos</code> (see <a href="worldwind.html#worldwind-viewer">WorldWind Viewer</a>).</p>
            <p>Not surprisingly, data acquisition is handled through dedicated actors that are associated with their
            corresponding <code>RaceRouteInfos</code>. Such actors are usually inner classes of their respective
            <code>RaceRouteInfos</code> (see e.g. <code>gov.nasa.race.http.HttpStatsReporter</code>) that extend
            <code>SubscribingRaceActor</code> and turn data received from the subscribed channels into <code>HttpContent</code>
            objects (aggregation of HTML page and associated resources such as images etc.). The <code>HttpContent</code>
            is stored in <code>RaceRouteInfo</code> and referenced from within its <code>route()</code> method to generate
            the response for valid HTTP requests.</p>
            <p>Although HTML content creation can be done manually, most <code>RaceRouteInfos</code> use the <a href="http://www.lihaoyi.com/scalatags/">ScalaTags</a>
            library, which provides a DSL that supports procedural elements in a tree that is
            very close to the created HTML structure.</p>
            <p><code>HttpServer</code> includes a powerful, per-request cookie based user authentication mechanism to
            support content that should not be publicly accessible.</p>
            <p>The <code>gov.nasa.race.http.Test{RouteInfo,Authorized,Refresh}</code> examples show how define routes and
            (self refreshing) HTML content.:</p>
            <pre><code>//--- basic RaceRouteInfo example
class TestRouteInfo (val parent: ParentContext, val config: Config) extends RaceRouteInfo {
  val request = config.getStringOrElse(&quot;request&quot;, &quot;test&quot;)
  val response = config.getStringOrElse(&quot;response&quot;, &quot;Hello from RACE&quot;)

  override def route = {
    path(request) {
      get {
        complete(HttpEntity(ContentTypes.`text/html(UTF-8)`, response))
      }
    }
  }
}

//--- example of how to implement authorized content for configured paths
class TestAuthorized (val parent: ParentContext, val config: Config) extends AuthorizedRaceRoute {
  val request = config.getStringOrElse(&quot;request&quot;, &quot;secret&quot;)
  var count = 0
  def page = html(
    body(
      p(s&quot;the supersecret answer #$count to the ultimate question of life, the universe and everything is:&quot;),
      p(b(&quot;42&quot;)),
      p(&quot;(I always knew there was something wrong with the universe)&quot;),
      logoutLink
    )
  )

  override def route = {
    path(request) {
      get {
        count += 1
        completeAuthorized(User.UserRole, HttpEntity(ContentTypes.`text/html(UTF-8)`, page.render))
      }
    }
  }
}</code></pre>
        </div>

    </body>
</html>