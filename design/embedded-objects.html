<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>RACE</title>

        <link href="../race-html.css" rel="stylesheet"/>
    </head>

    <body>
        <div class="navbar">
            <div class=""banner>
                <a href="index.html" ><img class="logo" src="../images/race128.png"></a>
                <p class="doctitle">RACE Manual</p>
            </div>
            <br/>
            <div class="toc">
                <p class="title">Project Links</p>
                <ul>
                    <li><span class="toc level2"><a href="https://github.com/NASARace/race.git">Repository</a></span></li>
                    <li><span class="toc level2"><a href="http://nasarace.github.io/race">Website</a></span></li>
                </ul>
            </div>
            <div class="pagetoc">
                <div class="toc">
                  <p class="title">Page</p>
                  <ul>
                    <li><span class="toc level1"><a href="#configuration">Configuration</a></span></li>
                    <li><span class="toc level1"><a href="#instantiation-api">Instantiation API</a></span></li>
                  </ul>
                </div>
            </div>
            <div class="globaltoc">
                <div class="toc">
                  <p class="title">Site</p>
                  <ul>
                    <li><span class="toc level1"><a href="../index.html">About RACE</a></span></li>
                    <li><span class="toc level1"><a href="../project-log.html">Project Log</a></span></li>
                    <li>
                      <p class="toc level1">Installing RACE</p>
                      <ul>
                        <li><span class="toc level2"><a href="../installation/prerequisites.html">Prerequisites</a></span></li>
                        <li><span class="toc level2"><a href="../installation/download.html">Downloading RACE</a></span></li>
                        <li><span class="toc level2"><a href="../installation/build.html">Building RACE</a></span></li>
                        <li><span class="toc level2"><a href="../installation/pitfalls.html">Installation Pitfalls</a></span></li>
                        <li><span class="toc level2"><a href="../installation/osx.html">OS X Specifics</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">Using RACE</p>
                      <ul>
                        <li><span class="toc level2"><a href="../usage/running.html">How to Run RACE</a></span></li>
                        <li><span class="toc level2"><a href="../usage/configuration.html">RACE Configuration</a></span></li>
                        <li><span class="toc level2"><a href="../usage/encryption.html">Using Encrypted Configurations</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1"><a href="../actors.html">Actors</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../actors.html#actor-components-and-properties">Actor Components and Properties</a></span></li>
                        <li><span class="toc level2"><a href="../actors.html#actor-communication">Actor Communication</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">RACE Design</p>
                      <ul>
                        <li><span class="toc level2"><a href="overview.html">Design Overview</a></span></li>
                        <li><span class="toc level2"><a href="configuration.html">Runtime Configuration</a></span></li>
                        <li><span class="toc level2"><a href="raceactors.html">RaceActors</a></span></li>
                        <li><span class="toc level2"><a href="channeltopics.html">ChannelTopics</a></span></li>
                        <li><span class="toc level2 active">Embedded Objects</span></li>
                        <li><span class="toc level2"><a href="connectivity.html">Connecting External Systems</a></span></li>
                        <li><span class="toc level2"><a href="rgis.html">RACE GIS Support</a></span></li>
                        <li><span class="toc level2"><a href="archive-replay.html">Archive and Replay</a></span></li>
                        <li><span class="toc level2"><a href="worldwind.html">WorldWind Viewer</a></span></li>
                        <li><span class="toc level2"><a href="http-server.html">HttpServer</a></span></li>
                        <li><span class="toc level2"><a href="timeseries.html">Time Series Analysis</a></span></li>
                        <li><span class="toc level2"><a href="remotelauncher.html">RemoteLauncher</a></span></li>
                        <li><span class="toc level2"><a href="layers-and-modules.html">Layers and Modules</a></span></li>
                        <li><span class="toc level2"><a href="directory-structure.html">Directory Structure</a></span></li>
                        <li><span class="toc level2"><a href="repository.html">Repository Structure</a></span></li>
                        <li><span class="toc level2"><a href="local-build.html">Local Build Configuration</a></span></li>
                        <li><span class="toc level2"><a href="dds.html">RACE and DDS</a></span></li>
                        <li><span class="toc level2"><a href="extproject.html">Using RACE from External Projects</a></span></li>
                        <li><span class="toc level2"><a href="whyscala.html">Why Scala</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1"><a href="../examples.html">RACE Examples</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../examples.html#basic-examples">Basic Examples</a></span></li>
                        <li><span class="toc level2"><a href="../examples.html#distributed-operation">Distributed Operation</a></span></li>
                        <li><span class="toc level2"><a href="../examples.html#live-data-import">Live Data Import</a></span></li>
                        <li><span class="toc level2"><a href="../examples.html#data-replay">Data Replay</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">Documentation</p>
                      <ul>
                        <li><span class="toc level2"><a href="../documentation/overview.html">RACE Documentation Overview</a></span></li>
                        <li><span class="toc level2"><a href="../documentation/presentations.html">Available Slide Presentations</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1"><a href="../known-problems.html">Known Problems</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../known-problems.html#problems-with-worldwind-jogl-native-libraries-on-linux">problems with WorldWind/JOGL native libraries on Linux</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#incompatible-class-file-errors-during-race-startup">incompatible class file errors during RACE startup</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#kafka-clients">kafka-clients</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#kafkaserver">KafkaServer</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#windows-console-output">Windows console output</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#race-not-starting-because-of-racevieweractor-timeout">RACE not starting because of RaceViewerActor timeout</a></span></li>
                      </ul>
                    </li>
                    <li><span class="toc level1"><a href="../changes.html">Changes</a></span></li>
                    <li><span class="toc level1"><a href="../todo.html">TODO List</a></span></li>
                    <li>
                      <p class="toc level1"><a href="../learning.html">Learning Resources</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../learning.html#scala">Scala</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#actors-and-akka">Actors and Akka</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#sbt">SBT</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#interactive-scala-akka-and-sbt-learning-environment-and-examples">Interactive Scala, Akka and SBT Learning Environment and Examples</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#git">Git</a></span></li>
                      </ul>
                    </li>
                    <li><span class="toc level1"><a href="../glossary.html">Glossary</a></span></li>
                  </ul>
                </div>
            </div>
        </div>

        <div class="main">
            <h1 id="embedded-objects" class="title">Embedded Objects</h1>
            <p>Many actors in RACE user inner objects to adapt otherwise generic actor functions such
            as translation, data import or archiving to specific data types, IO formats and destinations. This
            multi-layer approach to achieve genericity can be seen in examples such as <code>ArchiveActor</code> (writer),
            <code>TranslatorActor</code> (translator), <code>HttpServer</code> (routes), <code>RaceViewerActor</code> (layers) and others.</p>
            <p>The pattern of using nested objects and delegation to achieve specialization is so common that it is
            supported by RACEs <a href="configuration.html#runtime-configuration">Runtime Configuration</a> and the <code>RaceActor</code> API.</p>
            
            <h2 id="configuration" class="section">Configuration</h2>
            <p>RACEs <a href="https://github.com/typesafehub/config/blob/master/HOCON.md">HOCON</a> based configuration files use a hierarchical structure with object nesting to specify
            and parameterize objects:</p>
            <pre><code>...
actors = [ ...
  { //--- general config
    name = &quot;httpServer&quot;
    class = &quot;.http.HttpServer&quot;

    //--- type specific config
    host = &quot;localhost&quot;
    ...

    routes = [
      //--- nested object
      { name = &quot;statsReporter&quot;
        class = &quot;.http.HttpStatsReporter&quot;

        read-from = &quot;/stats&quot;
       ...
      }, ...
    ]
  } ...</code></pre>
            <p>This structure can nest to any level, but usually there is just a top level actor (e.g. <code>&quot;httpServer&quot;</code>)
            with one or more embedded delegation objects (<code>&quot;statsReporter&quot;</code>). Each object needs at least a
            <code>class = &lt;classname&gt;</code> spec. A <code>name = &lt;object-name&gt;</code> is mandatory for top level actors and optional
            for most embedded objects. RACE configs are open, i.e. apart from the mandatory class name they can
            have any number of parameters only the concrete class has to know about - there is no central registry
            that needs to be updated when parameter names are added or removed.</p>
            
            <h2 id="instantiation-api" class="section">Instantiation API</h2>
            <p>To instantiate embedded objects from configuration files, the <code>RaceActor</code> trait provides the
            following APIs that can be used from inside of actor constructors:</p>
            <ul>
              <li><code>configurable[T](key: String): Option[T]</code> - for optional embedded objects</li>
              <li><code>getConfigurable[T](key: String): T</code> - for mandatory objects (throws exception if missing)</li>
              <li><code>getConfigurableOrElse[T](key: String)(f: =&gt; T): T</code> - for mandatory objects using defaults</li>
              <li><code>getConfigurables[T](key: String): Array[T]</code> - for lists of embedded objects</li>
              <li><code>configurable[T](conf: Config): Option[T]</code> - for deeper level objects using the actor class loader</li>
            </ul>
            <p>In all cases, the compiler has to be able to infer the type of the requested object class in order
            to runtime check the instantiated object. This can be done by providing the field type in the
            actor constructor, but more commonly instantiation is factored out into a separate <code>createX(): T</code>
            method so that embedded object types can be hard-wired in more specific  actor sub-classes (see for
            instance <code>gov.nasa.race.actor.TranslatorActor</code> and <code>gov.nasa.race.air.actor.SBSTranslatorActor</code>):</p>
            <pre><code>class TranslatorActor (val config: Config) extends SubscribingRaceActor ... {

  var translator: Translator[Any,Any] = createTranslator

 // override this to use a hardwired translator
 protected def createTranslator: Translator[Any,Any] = getConfigurable[Translator[Any,Any]](&quot;translator&quot;)</code></pre>
        </div>

    </body>
</html>