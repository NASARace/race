<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>RACE</title>

        <link href="../race-html.css" rel="stylesheet"/>
    </head>

    <body>
        <div class="navbar">
            <div class=""banner>
                <a href="index.html" ><img class="logo" src="../images/race128.png"></a>
                <p class="doctitle">RACE Manual</p>
            </div>
            <br/>
            <div class="toc">
                <p class="title">Project Links</p>
                <ul>
                    <li><span class="toc level2"><a href="https://github.com/NASARace/race.git">Repository</a></span></li>
                    <li><span class="toc level2"><a href="http://nasarace.github.io/race">Website</a></span></li>
                </ul>
            </div>
            <div class="pagetoc">
                <div class="toc">
                  <p class="title">Page</p>
                  <ul>
                    <li><span class="toc level1"><a href="#archive">Archive</a></span></li>
                    <li><span class="toc level1"><a href="#replay">Replay</a></span></li>
                  </ul>
                </div>
            </div>
            <div class="globaltoc">
                <div class="toc">
                  <p class="title">Site</p>
                  <ul>
                    <li><span class="toc level1"><a href="../index.html">About RACE</a></span></li>
                    <li><span class="toc level1"><a href="../project-log.html">Project Log</a></span></li>
                    <li>
                      <p class="toc level1">Installing RACE</p>
                      <ul>
                        <li><span class="toc level2"><a href="../installation/prerequisites.html">Prerequisites</a></span></li>
                        <li><span class="toc level2"><a href="../installation/download.html">Downloading RACE</a></span></li>
                        <li><span class="toc level2"><a href="../installation/build.html">Building RACE</a></span></li>
                        <li><span class="toc level2"><a href="../installation/pitfalls.html">Installation Pitfalls</a></span></li>
                        <li><span class="toc level2"><a href="../installation/osx.html">OS X Specifics</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">Using RACE</p>
                      <ul>
                        <li><span class="toc level2"><a href="../usage/running.html">How to Run RACE</a></span></li>
                        <li><span class="toc level2"><a href="../usage/configuration.html">RACE Configuration</a></span></li>
                        <li><span class="toc level2"><a href="../usage/encryption.html">Using Encrypted Configurations</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1"><a href="../actors.html">Actors</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../actors.html#actor-components-and-properties">Actor Components and Properties</a></span></li>
                        <li><span class="toc level2"><a href="../actors.html#actor-communication">Actor Communication</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">RACE Design</p>
                      <ul>
                        <li><span class="toc level2"><a href="overview.html">Design Overview</a></span></li>
                        <li><span class="toc level2"><a href="configuration.html">Runtime Configuration</a></span></li>
                        <li><span class="toc level2"><a href="raceactors.html">RaceActors</a></span></li>
                        <li><span class="toc level2"><a href="channeltopics.html">ChannelTopics</a></span></li>
                        <li><span class="toc level2"><a href="embedded-objects.html">Embedded Objects</a></span></li>
                        <li><span class="toc level2"><a href="connectivity.html">Connecting External Systems</a></span></li>
                        <li><span class="toc level2"><a href="rgis.html">RACE GIS Support</a></span></li>
                        <li><span class="toc level2 active">Archive and Replay</span></li>
                        <li><span class="toc level2"><a href="worldwind.html">WorldWind Viewer</a></span></li>
                        <li><span class="toc level2"><a href="http-server.html">HttpServer</a></span></li>
                        <li><span class="toc level2"><a href="timeseries.html">Time Series Analysis</a></span></li>
                        <li><span class="toc level2"><a href="remotelauncher.html">RemoteLauncher</a></span></li>
                        <li><span class="toc level2"><a href="layers-and-modules.html">Layers and Modules</a></span></li>
                        <li><span class="toc level2"><a href="directory-structure.html">Directory Structure</a></span></li>
                        <li><span class="toc level2"><a href="repository.html">Repository Structure</a></span></li>
                        <li><span class="toc level2"><a href="local-build.html">Local Build Configuration</a></span></li>
                        <li><span class="toc level2"><a href="dds.html">RACE and DDS</a></span></li>
                        <li><span class="toc level2"><a href="extproject.html">Using RACE from External Projects</a></span></li>
                        <li><span class="toc level2"><a href="whyscala.html">Why Scala</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1"><a href="../examples.html">RACE Examples</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../examples.html#basic-examples">Basic Examples</a></span></li>
                        <li><span class="toc level2"><a href="../examples.html#distributed-operation">Distributed Operation</a></span></li>
                        <li><span class="toc level2"><a href="../examples.html#live-data-import">Live Data Import</a></span></li>
                        <li><span class="toc level2"><a href="../examples.html#data-replay">Data Replay</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1">Documentation</p>
                      <ul>
                        <li><span class="toc level2"><a href="../documentation/overview.html">RACE Documentation Overview</a></span></li>
                        <li><span class="toc level2"><a href="../documentation/presentations.html">Available Slide Presentations</a></span></li>
                      </ul>
                    </li>
                    <li>
                      <p class="toc level1"><a href="../known-problems.html">Known Problems</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../known-problems.html#problems-with-worldwind-jogl-native-libraries-on-linux">problems with WorldWind/JOGL native libraries on Linux</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#incompatible-class-file-errors-during-race-startup">incompatible class file errors during RACE startup</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#kafka-clients">kafka-clients</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#kafkaserver">KafkaServer</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#windows-console-output">Windows console output</a></span></li>
                        <li><span class="toc level2"><a href="../known-problems.html#race-not-starting-because-of-racevieweractor-timeout">RACE not starting because of RaceViewerActor timeout</a></span></li>
                      </ul>
                    </li>
                    <li><span class="toc level1"><a href="../changes.html">Changes</a></span></li>
                    <li><span class="toc level1"><a href="../todo.html">TODO List</a></span></li>
                    <li>
                      <p class="toc level1"><a href="../learning.html">Learning Resources</a></p>
                      <ul>
                        <li><span class="toc level2"><a href="../learning.html#scala">Scala</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#actors-and-akka">Actors and Akka</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#sbt">SBT</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#interactive-scala-akka-and-sbt-learning-environment-and-examples">Interactive Scala, Akka and SBT Learning Environment and Examples</a></span></li>
                        <li><span class="toc level2"><a href="../learning.html#git">Git</a></span></li>
                      </ul>
                    </li>
                    <li><span class="toc level1"><a href="../glossary.html">Glossary</a></span></li>
                  </ul>
                </div>
            </div>
        </div>

        <div class="main">
            <h1 id="archive-and-replay" class="title">Archive and Replay</h1>
            <p>Archive- and ReplayActors are similar to Export- and ImportActors (see <a href="connectivity.html#connecting-external-systems">Connecting External Systems</a>),
            and can in fact be seen as a local persistency export/import that uses the same layer partitioning:
            actors being responsible for connectivity and time, and embedded writer/reader objects being
            responsible for data format and RACE-external IO.</p>
            <p>It is therefore common to have RACE <a href="configuration.html#runtime-configuration">Runtime Configuration</a> files that have archive and replay
            variants of their live counterparts. Archive configs normally add ArchiveActors for selected RACE
            input channels (e.g. to store SWIM XML messages). Replay configs replace Import- with ReplayActors.</p>
            
            <h2 id="archive" class="section">Archive</h2>
            <p><code>gov.nasa.race.actor.ArchiveActor</code> is the more simple type. This is a typical <code>SubscribingRaceActor</code>
            for which there is little reason of subtyping other than perhaps hard-wiring respective
            <code>ArchiveWriter</code> types (which can be seen as syntactic sugar for RACE configs).</p>
            <p>The main purpose of <code>ArchiveActor</code> is to provide the <code>RaceActor</code> context that:</p>
            <ol class="arabic">
              <li>instantiates a configured, embedded <code>ArchiveWriter</code> object</li>
              <li>subscribes to RACE channels that should be archived</li>
              <li>calls the <code>ArchiveWriter</code> from its <code>handleMessage</code> method with the message payload data</li>
            </ol>
            <p><img class="center scale80" src="../images/archive.svg" alt="ArchiveActor and ArchiveWriter"></p>
            <p>The protected <code>createWriter</code> method can be overridden in subtypes to hardwire writer types. The
            standard implementation reads the <code>ArchiveActor</code> config file to extract the <code>writer</code> sub-config.</p>
            <p>Most writers that come with RACE are for basic input data such as XML messages, i.e. writers treat
            the payload data as un-structured text that is wrapped into begin/end markers which also record
            the simulation time stamp when the message was archived (e.g. <code>gov.nasa.race.archive.TextArchiveWriter</code>).
            However, writers can also store binary data and omit extra time stamps if the payload already
            contains one (see <code>gov.nasa.race.air.BinaryFlightPosArchiver</code> example).</p>
            <p>While specialized <code>ArchiveWriters</code> could also perform tasks such as filtering or translation,
            this is better left for dedicated actors since there is little to be gained by saving actors at the
            end of the message processing chain (as opposed to including filters inside the import/replay actor,
            which is the beginning of the chain).</p>
            
            <h2 id="replay" class="section">Replay</h2>
            <p><code>gov.nasa.race.actor.ReplayActor</code> is the more complex actor type, due to embedded filtering, lookup
            of replay points inside of archives, and scheduling of replay events according to their archive
            time stamps.</p>
            <p>Filtering is done by extending <code>FilteringPublisher</code>, which in turn instantiates the filter objects
            from the actor config. It makes sense to use embedded filters in case only few events from a
            otherwise large stream are replayed (e.g. only a few aircraft from a full SFDPS SWIM channel), to
            avoid importing high volume/rate data that is just filtered out by downstream FilterActors (which
            incurs the context switching between actors). The exception to this rule is if the filtering
            process itself is computationally expensive (more so than context switching) and can be effectively
            parallelized (e.g. by means of a <code>Dispatcher</code>).</p>
            <p><img class="center scale90" src="../images/replay.svg" alt="ReplayActor and ArchiveReader"></p>
            <p>Again, the stock <code>ReplayActor</code> is usually just sub-typed to hard-wire its <code>ArchiveReader</code> by
            overriding the <code>createReader()</code> method.</p>
            <p>During the RaceActor initialization phase the <code>ReplayActor</code> uses the <code>ArchiveReader</code> to extract
            the first <code>ArchiveEntry</code> from the archive file that has a time stamp greater or equal the
            configured simulation start time. There is also a optional boolean <code>can-reset-clock</code> config value
            that can be used to request a simulation time reset according to the first time stamp encountered
            in the archive, but this should only be used by one replay actor and might fail if other actors
            do not support a clock reset.</p>
            <p>Upon receiving the <code>StartRaceActor</code> system event the <code>ReplayActor</code> schedules its first event
            by calculating the respective wall clock time for the replay from the duration between current and
            event simulation time (which might involve both offset and timescale factor).</p>
            <p>When the scheduler send the corresponding <code>Replay</code> event, the actor&#39;s <code>handleMessage()</code> passes
            the payload on to a <code>replayMessageNow()</code> message, which is the filtering/publishing point. After
            publishing to the configured RACE channel(s) this method calls <code>scheduleNext()</code>, which uses the
            reader to retrieve the next <code>ArchiveEntry</code> (if any) and closes the replay loop by scheduling the
            event according to its time stamp.</p>
            <p>It should be noted that the <code>ReplayActor</code> only skips events at the beginning of the stream, if
            their time stamps precede the simulation start time. Once the actor starts replaying it
            processes all archived events until the archive is either exhausted or RACE is shut down. This
            reflects the principle that data consistency is rated higher than minimizing the difference between
            archived and actual replay simulation time. The rationale is that replay latency is usually &lt;50msec
            and archived streams are not deterministic to begin with (involve network IO) - RACE is not supposed
            to be a hard-realtime environment.</p>
        </div>

    </body>
</html>